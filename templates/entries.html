{% extends 'base.html' %}
{% block title %}All Entries - All Debit{% endblock %}
{% block extra_head %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
{% endblock %}
{% block content %}
  <h2>All Debit Entries</h2>
  <input type="text" id="searchInput" placeholder="Search table..." style="margin-bottom:10px;padding:5px;width:250px;">
  <table id="entriesTable">
    <thead>
      <tr>
        <th onclick="sortTable(0)">Date</th>
        <th onclick="sortTable(1)">Price</th>
        <th onclick="sortTable(2)">Payment Method</th>
        <th onclick="sortTable(3)">Payment Reason</th>
        <th>By User</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
    {% for entry in entries %}
      <tr>
        <td>{{ entry.date }}</td>
        <td>{{ '%.2f' % entry.price }}</td>
        <td>{{ entry.payment_method }}</td>
        <td>{{ entry.payment_reason }}</td>
        <td>{{ entry.user_id }}</td>
        <td><a href="{{ url_for('update_entry', entry_id=entry.id) }}">Update</a> |
        <a href="{{ url_for('delete_entry', entry_id=entry.id) }}" onclick="return confirm('Are you sure you want to delete this entry?');" style="color:red;">Delete</a>
        </td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
  <script>
    // Filter
    $("#searchInput").on("keyup", function() {
      var value = $(this).val().toLowerCase();
      $("#entriesTable tbody tr").filter(function() {
        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
      });
    });
    // Sort
    function sortTable(n) {
      var table = document.getElementById("entriesTable");
      var rows = table.rows, switching = true, shouldSwitch, dir = "asc", switchcount = 0;
      while (switching) {
        switching = false;
        var trs = table.tBodies[0].rows;
        for (var i = 0; i < trs.length - 1; i++) {
          shouldSwitch = false;
          var x = trs[i].getElementsByTagName("TD")[n];
          var y = trs[i + 1].getElementsByTagName("TD")[n];
          var xVal = x.textContent || x.innerText;
          var yVal = y.textContent || y.innerText;
          if (n == 1) { xVal = parseFloat(xVal); yVal = parseFloat(yVal); }
          if ((dir == "asc" && xVal > yVal) || (dir == "desc" && xVal < yVal)) {
            shouldSwitch = true;
            break;
          }
        }
        if (shouldSwitch) {
          trs[i].parentNode.insertBefore(trs[i + 1], trs[i]);
          switching = true;
          switchcount++;
        } else {
          if (switchcount == 0 && dir == "asc") { dir = "desc"; switching = true; }
        }
      }
    }
  </script>
{% endblock %}
